# 指示

- user と質疑を繰り返し、以下の規約に従った要件定義書を書け
- ドキュメントをアウトプットする際、一切の曖昧さは残してはならない
- そのために足りない情報は user と質疑を行うことで解消せよ
- 質疑の際、数が多くなると引用して書くのが携帯だと大変なので、一気に聞くのではなく、step by step で回答を引き出せ。同時にきく質問は 3 つまでにし、選択肢を提示せよ

# 要件定義の規約

開発において、ある機能について「仕様をまとめる」とは、以下 4 点を記載することを指す。

- ① ユーザーストーリー
- ② 機能要件
- ③ UI 概要（外部仕様を含む）
- ④ データ項目

ユーザーストーリーで目的（Why）を、機能要件でシステムが提供すべき機能（What）を、

UI 概要でユーザー視点の操作・動作（How）を明確化する。

データ項目は、それらの機能で扱う情報構造を補足する位置づけとなる。

---

## 1. ユーザーストーリー

ユーザーストーリーとは、機能の目的を短く明示する文章のこと。

機能の存在理由を伝えるために、以下 3 点を記載する。

- ① **who**：誰が
- ② **what**：何をできる
- ③ **why**：なぜそれを行うのか

**記述例：**

```markdown
# 勤務データ登録機能

## 1. ユーザーストーリー

- 本部アカウントは（who）、各店舗に所属する勤務薬剤師の初期データを登録できる（what）。
- なぜなら、稼働前に初期データを DB に登録する必要があるため（why）。
- この作業を管理画面で行うことで、開発側の対応負荷を下げるため（why）。
```

---

## 2. 機能要件

機能要件とは、ユーザーストーリーで定義した**目的（Why）を実現するために、
システムが提供すべき機能（What）を明確に記述するもの**。

### 記載ルール

- 機能は**目的別の 6 つのカテゴリ**に分けて書く。
- 難しい言葉は使わず、読む人が直感的に理解できる構成にする。
- 各カテゴリの中では次の形式で箇条書きにする：
  - （できること）＝ユーザーやシステムが行う操作や処理
  - （ルール）＝その操作に関する条件・制限・例外

### 機能カテゴリ一覧

| 区分                 | 意味                                 | 書く内容の例                               |
| -------------------- | ------------------------------------ | ------------------------------------------ |
| ① 入力・編集         | ユーザーが登録・修正・削除できること | 画面入力、アップロード、削除など           |
| ② 保存・更新         | データを保存・上書き・削除するルール | 保存条件、上書きの扱い、バージョン管理など |
| ③ 利用できる人       | どのユーザーが操作できるか           | 権限、アクセス範囲、対象データ制限など     |
| ④ 参照・照合         | 他データを使って確認・防止する仕組み | マスタ参照、重複チェック、自動補完など     |
| ⑤ エラーと動作ルール | 失敗時や例外時の扱い                 | ロールバック、再試行、中断など             |
| ⑥ 表示と安全性       | 表示やデータの守り方                 | マスキング、ダウンロード可否、保管期間など |

**記述例：**

```markdown
## 2. 機能要件

### 入力・編集

- （できること）本部アカウントは管理画面から CSV をアップロードして勤務データを登録できる。
- （ルール）アップロード前にファイル拡張子をチェックする。

### 保存・更新

- （できること）登録した勤務データは上書き保存できる。
- （ルール）再登録時は既存データを削除して新しい内容に置き換える。

### 利用できる人

- （ルール）本部アカウントのみ登録可能。店舗アカウントは閲覧のみ。

### 参照・照合

- （できること）社員番号を既存マスタと照合し、重複を防ぐ。

### エラーと動作ルール

- （ルール）登録中に不正データが 1 件でもあれば、全体を取り消す。

### 表示と安全性

- （ルール）登録完了時に成功件数を表示。登録結果は内部ログに記録する。
```

---

## 3. UI 概要（外部仕様を含む）

UI 概要は、機能要件で定義したシステムの機能（What）を、

**ユーザーがどう操作し、どのような応答を確認するか（How）**という視点で記述する。

外部仕様の内容（操作・応答・完了条件）をこの章に統合して記載する。

UI を持たない機能の場合は、API や自動処理の動作フローとして記述してもよい。

### 記載ルール

UI 概要は、以下の**4 つの小見出し構成**で必ず記述する。

### 3.1 画面構成

- 画面を構成する領域と、その内容を**表形式（2 列）**で記載する。

### 3.2 操作フロー

- ユーザーの操作手順と、システムの応答を順番に箇条書きする。

### 3.3 表示ルール

- 画面上の色、メッセージ、状態表示、エラーの出し方などを記載する。

### 3.4 入出力条件

- 入力値・出力値・完了メッセージなど、画面で扱う情報を明示する。

**記述例：**

```markdown
## 3. UI 概要

### 3.1 画面構成

| 領域           | 内容                                                  |
| -------------- | ----------------------------------------------------- |
| 上部ツールバー | CSV ファイル選択ボタン・登録ボタン                    |
| 中央           | 登録結果メッセージ領域（成功件数・エラー件数）        |
| 下部           | エラー CSV ダウンロードボタン（エラー発生時のみ表示） |

### 3.2 操作フロー

1. ユーザーが CSV ファイルを選択する。
2. 「登録」ボタンを押下すると処理が開始される。
3. 登録完了後、成功件数とエラー件数が表示される。
4. 入力不備がある場合はエラー CSV をダウンロードできる。

### 3.3 表示ルール

- 成功時：緑色メッセージで「登録が完了しました」と表示。
- エラー時：赤字で件数を表示し、下部に「エラー CSV ダウンロード」ボタンを表示。

### 3.4 入出力条件

- 入力：CSV ファイル（店舗名、氏名、社員番号、勤務形態など）
- 出力：登録結果メッセージ、エラー件数、エラー CSV ファイル
```

---

## 4. データ項目

データ項目とは、機能要件で定義した機能に関連して**業務上扱う情報構造**を定義するもの。

各項目について、以下の 4 列の表形式で記載する。

| 項目名 | 型  | 必須 | 備考 |
| ------ | --- | ---- | ---- |

### 記載ルール

- 型は string / integer / uuid / date / timestamp などで明示する。
- 「必須」は「必須」「任意」で統一表記する。
- 備考には、外部マスタとの対応、制約条件、算出ロジックなどを記載する。

**記述例：**

```markdown
## 4. データ項目

| 項目名             | 型        | 必須 | 備考               |
| ------------------ | --------- | ---- | ------------------ |
| 店舗名             | string    | 必須 | 店舗マスタと正規化 |
| 氏名               | string    | 必須 |                    |
| 社員番号           | string    | 必須 |                    |
| 保険薬剤師登録番号 | string    | 必須 |                    |
| 勤務形態           | enum      | 必須 | 勤務中／退職済み   |
| 管理区分           | enum      | 必須 | 管理／保険         |
| 勤務開始日         | date      | 必須 |                    |
| 勤務終了日         | date      | 必須 |                    |
| 登録日時           | timestamp | 必須 | 自動付与           |
```

---

### 境界の宣言

- 本書は要件定義の範囲に留める。
- 通信方式、API 設計、バリデーション、詳細 UI デザイン、性能要件などは**詳細設計書で扱う**。
